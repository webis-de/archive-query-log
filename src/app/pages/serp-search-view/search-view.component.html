<div class="flex flex-col h-full">
  <app-search-header
    [searchQuery]="searchQuery"
    [config]="{
      labelKey: 'search.label',
      placeholderKey: 'search.placeholder',
      showFilterDropdown: true,
      showSuggestions: true,
      showEntityTabs: false,
    }"
    [isPanelOpen]="isPanelOpen()"
    [isTransitionEnabled]="isTransitionEnabled()"
    [isSidebarCollapsed]="isSidebarCollapsed()"
    [showSuggestionsDropdown]="showSuggestions()"
    [suggestions]="suggestions()"
    [initialFilters]="initialFilters"
    [activeFilters]="activeFilters"
    (searchQueryChange)="onSearchInput($event)"
    (searchAction)="onSearch(); showSuggestions.set(false)"
    (searchFocus)="onSearchFocus()"
    (suggestionSelect)="onSuggestionSelect($event)"
    (filtersChanged)="onFiltersChanged($event)"
  ></app-search-header>

  <div class="flex flex-row flex-1 overflow-hidden">
    <div
      class="flex-1 overflow-y-auto px-4 py-6 relative"
      [class.transition-all]="isTransitionEnabled()"
      [class.duration-300]="isTransitionEnabled()"
    >
      <div
        [class.transition-all]="isTransitionEnabled()"
        [class.duration-300]="isTransitionEnabled()"
        [class.lg:ml-40]="!isPanelOpen()"
        [class.lg:ml-0]="isPanelOpen()"
      >
        @if (!isLoading() && hasSearched() && totalCount() > 0) {
          <div class="flex flex-row flex-nowrap gap-6 w-full">
            <div class="flex-1 w-full max-w-[800px]">
              <div class="mb-4">
                <p class="text-sm text-gray-600">
                  {{ 'search.resultsFound' | translate: { count: totalCount() } }}
                </p>
              </div>

              <div class="flex flex-col gap-4">
                @for (result of searchResults(); track result._id) {
                  <app-search-result-item
                    [result]="result"
                    [isActive]="selectedResult()?._id === result._id"
                    (clicked)="onResultClick($event)"
                  ></app-search-result-item>
                }
              </div>

              <div class="h-8"></div>
            </div>

            @if (!isPanelOpen()) {
              <app-query-overview-panel
                class="w-full min-w-[200px] max-w-[400px] pt-9 self-start"
                [query]="searchQuery"
                [data]="queryMetadata()"
                [isLoading]="isMetadataLoading()"
                [interval]="metadataInterval()"
                (intervalChange)="onMetadataIntervalChange($event)"
              ></app-query-overview-panel>
            }
          </div>
        } @else {
          <div class="flex-1 w-full max-w-[800px]">
            @if (isLoading()) {
              <div class="flex justify-center items-center py-12">
                <div class="text-lg">{{ 'common.loading' | translate }}</div>
              </div>
            } @else if (hasSearched() && totalCount() === 0) {
              <div class="flex justify-center items-center py-12">
                <div class="text-lg text-gray-600">
                  {{ 'search.noResultsFor' | translate: { query: searchQuery } }}
                </div>
              </div>
            } @else {
              <div class="flex justify-center items-center py-12">
                <div class="text-lg text-gray-600">{{ 'search.enterQuery' | translate }}</div>
              </div>
            }
          </div>
        }
      </div>

      @if (!isLoading() && hasSearched() && totalCount() > 0) {
        <div class="sticky bottom-0 z-40 w-full pb-6 pt-4 pointer-events-none">
          <aql-pagination
            [totalItems]="totalCount()"
            [pageSize]="pageSize()"
            [currentPage]="currentPage()"
            [showPageSizeSelector]="true"
            [size]="'md'"
            [contentMaxWidth]="'800px'"
            [contentClass]="!isPanelOpen() ? 'pl-[10vw]' : 'pl-0'"
            [showSelectorLabel]="!isPanelOpen()"
            (pageChange)="onPageChange($event)"
            (pageSizeChange)="onPageSizeChange($event)"
          ></aql-pagination>
        </div>
      }
    </div>
    <app-query-metadata-panel
      [isOpen]="isPanelOpen()"
      [searchResult]="selectedResult()"
      (closePanel)="onClosePanel()"
      (relatedSerpSelected)="onRelatedSerpSelected($event)"
    ></app-query-metadata-panel>
  </div>
</div>
