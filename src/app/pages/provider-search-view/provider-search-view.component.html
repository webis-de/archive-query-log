<div class="flex flex-col h-full">
  <app-search-header
    [searchQuery]="searchQuery()"
    [config]="{
      labelKey: 'providers.searchLabel',
      placeholderKey: 'providers.searchPlaceholder',
      showFilterDropdown: false,
      showSuggestions: false,
      showEntityTabs: false,
    }"
    [isPanelOpen]="isPanelOpen()"
    [isTransitionEnabled]="isTransitionEnabled()"
    [isSidebarCollapsed]="true"
    (searchQueryChange)="onSearchInput($event)"
  ></app-search-header>

  <div class="flex flex-row flex-1 overflow-hidden">
    <div class="flex-1 flex flex-col relative overflow-hidden">
      <!-- Scrollable Viewport -->
      <cdk-virtual-scroll-viewport
        class="flex-1 w-full"
        itemSize="140"
        [class.transition-all]="isTransitionEnabled()"
        [class.duration-300]="isTransitionEnabled()"
      >
        <div
          class="px-4 py-6"
          [class.transition-all]="isTransitionEnabled()"
          [class.duration-300]="isTransitionEnabled()"
          [class.lg:ml-40]="!isPanelOpen()"
          [class.lg:ml-0]="isPanelOpen()"
        >
          @if (!isLoading() && hasSearched() && totalCount() > 0) {
            <div class="flex-1 w-full max-w-[800px]">
              <div class="mb-4">
                <p class="text-sm text-gray-600">
                  {{ 'providers.resultsFound' | translate: { count: totalCount() } }}
                </p>
              </div>

              <div class="flex flex-col">
                <div
                  *cdkVirtualFor="let provider of filteredProviders(); trackBy: trackByProviderId"
                  class="mb-4"
                >
                  <app-search-result-item
                    [provider]="provider"
                    [isActive]="selectedProvider()?.id === provider.id"
                    (clicked)="onProviderClick($event)"
                  ></app-search-result-item>
                </div>
              </div>
            </div>
          } @else {
            <div class="flex-1 w-full max-w-[800px]">
              @if (isLoading()) {
                <div class="flex justify-center items-center py-12">
                  <div class="text-lg">{{ 'common.loading' | translate }}</div>
                </div>
              } @else if (hasSearched() && totalCount() === 0) {
                <div class="flex justify-center items-center py-12">
                  <div class="text-lg text-gray-600">
                    {{ 'providers.noResultsFor' | translate: { query: searchQuery } }}
                  </div>
                </div>
              } @else {
                <div class="flex justify-center items-center py-12">
                  <div class="text-lg text-gray-600">{{ 'providers.enterQuery' | translate }}</div>
                </div>
              }
            </div>
          }
        </div>
      </cdk-virtual-scroll-viewport>
    </div>

    <!-- Provider Detail Panel -->
    <app-query-metadata-panel
      [isOpen]="isPanelOpen()"
      [providerDetail]="selectedProviderDetail()"
      [isLoading]="isDetailLoading()"
      [error]="detailError()"
      (closePanel)="onClosePanel()"
    ></app-query-metadata-panel>
  </div>
</div>
