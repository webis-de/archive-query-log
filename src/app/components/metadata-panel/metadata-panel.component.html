@if (isOpen()) {
  <div [ngClass]="panelClasses()">
    <div class="flex items-center justify-between px-6 py-4 gap-4 border-b border-base-300">
      <div class="flex-1 min-w-0">
        @if (searchResult(); as result) {
          <h2 class="text-lg font-semibold truncate">
            {{ result._source.url_query }}
          </h2>
          <a
            [href]="result._source.capture.url"
            target="_blank"
            rel="noopener noreferrer"
            class="text-sm text-primary hover:underline truncate block"
          >
            {{ result._source.capture.url }}
          </a>
        } @else {
          <h2 class="text-lg font-semibold">{{ 'metadata.panel' | translate }}</h2>
        }
      </div>
      <aql-button
        iconStyle="square"
        iconBefore="bi-x-lg"
        size="md"
        (buttonClick)="onClose()"
        class="flex-shrink-0"
      ></aql-button>
    </div>

    <div class="px-6 pt-4 border-b border-base-300">
      <aql-tab-menu
        [tabs]="tabs()"
        [activeTabId]="activeTab()"
        [size]="'sm'"
        [tabStyle]="'border'"
        (tabChange)="onTabChange($event)"
      ></aql-tab-menu>
    </div>

    <div class="flex-1 overflow-y-auto">
      @switch (activeTab()) {
        @case ('text') {
          <div class="p-6">
            <div class="mb-4">
              <h3 class="text-sm font-semibold uppercase text-base-content/60 mb-2">
                {{ 'metadata.plainTextView' | translate }}
              </h3>
              <p class="text-sm text-base-content/80 leading-relaxed whitespace-pre-line">
                {{ getExtractionText() }}
              </p>
            </div>
          </div>
        }
        @case ('html') {
          <div class="p-6">
            <div class="mb-4">
              <h3 class="text-sm font-semibold uppercase text-base-content/60 mb-2">
                {{ 'metadata.htmlView' | translate }}
              </h3>
              @if (searchResult(); as result) {
                <div class="bg-base-200 rounded-lg p-4">
                  <code class="text-xs">
                    <pre class="whitespace-pre-wrap break-words">{{ result._source | json }}</pre>
                  </code>
                </div>
              }
            </div>
          </div>
        }
        @case ('website') {
          <div class="p-6">
            <div class="mb-4">
              <h3 class="text-sm font-semibold uppercase text-base-content/60 mb-2">
                {{ 'metadata.websitePreview' | translate }}
              </h3>
              @if (searchResult(); as result) {
                <iframe
                  [src]="getSafeUrl(result._source.capture.url)"
                  class="w-full h-[600px] border border-base-300 rounded-lg"
                  sandbox="allow-scripts allow-same-origin"
                ></iframe>
              }
            </div>
          </div>
        }
        @case ('metadata') {
          <div class="p-6">
            <div class="space-y-4">
              <h3 class="text-sm font-semibold uppercase text-base-content/60">
                {{ 'metadata.metadata' | translate }}
              </h3>
              @if (searchResult(); as result) {
                <div class="space-y-3 text-sm">
                  <div class="flex justify-between py-2 border-b border-base-300">
                    <span class="font-semibold text-base-content/70"
                      >{{ 'metadata.score' | translate }}:</span
                    >
                    <span>{{ result._score | number: '1.2-2' }}</span>
                  </div>
                  <div class="flex justify-between py-2 border-b border-base-300">
                    <span class="font-semibold text-base-content/70"
                      >{{ 'metadata.documentId' | translate }}:</span
                    >
                    <span class="text-xs break-all">{{ result._id }}</span>
                  </div>
                  <div class="flex justify-between py-2 border-b border-base-300">
                    <span class="font-semibold text-base-content/70"
                      >{{ 'metadata.mimeType' | translate }}:</span
                    >
                    <span>{{ result._source.capture.mimetype }}</span>
                  </div>
                  <div class="flex justify-between py-2 border-b border-base-300">
                    <span class="font-semibold text-base-content/70"
                      >{{ 'metadata.timestamp' | translate }}:</span
                    >
                    <span>{{ result._source.capture.timestamp }}</span>
                  </div>
                  <div class="flex justify-between py-2 border-b border-base-300">
                    <span class="font-semibold text-base-content/70"
                      >{{ 'metadata.provider' | translate }}:</span
                    >
                    <span>{{ result._source.provider.domain }}</span>
                  </div>
                </div>
              }
            </div>
          </div>
        }
      }
    </div>
  </div>
}
