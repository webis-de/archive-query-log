<div [ngClass]="panelClasses()">
  <div [ngClass]="contentWrapperClasses()" class="h-full flex flex-col">
    <div
      class="flex items-center justify-between px-6 py-4 gap-4 border-b border-base-300 shrink-0"
    >
      <div class="flex-1 min-w-0">
        @if (searchResult(); as result) {
          <h2 class="text-lg font-semibold truncate">
            {{ result._source.url_query }}
          </h2>
          <a
            [href]="result._source.capture.url"
            target="_blank"
            rel="noopener noreferrer"
            class="text-sm text-primary hover:underline truncate block"
          >
            {{ result._source.capture.url }}
          </a>
        } @else {
          <h2 class="text-lg font-semibold">{{ 'metadata.panel' | translate }}</h2>
        }
      </div>
      <div class="flex gap-2 shrink-0">
        @if (history().length > 0) {
          <aql-button
            iconStyle="square"
            iconBefore="bi-arrow-left"
            size="md"
            [aqlTooltip]="'tooltip.metadata.backOne' | translate"
            [tooltipPosition]="'top'"
            [attr.aria-label]="'metadata.backOne' | translate"
            (buttonClick)="onBackOne()"
          ></aql-button>
        }
        @if (isViewingRelatedSerp()) {
          <aql-button
            iconStyle="square"
            iconBefore="bi-arrow-bar-left"
            size="md"
            [aqlTooltip]="'tooltip.metadata.backToOriginal' | translate"
            [tooltipPosition]="'top'"
            [attr.aria-label]="'metadata.backToOriginal' | translate"
            (buttonClick)="onBackToOriginal()"
          ></aql-button>
        }
        <aql-button
          iconStyle="square"
          iconBefore="bi-x-lg"
          size="md"
          (buttonClick)="onClose()"
        ></aql-button>
      </div>
    </div>

    <div class="px-6 pt-4 border-b border-base-300">
      <aql-tab-menu
        [tabs]="tabs()"
        [activeTabId]="activeTab()"
        [size]="'sm'"
        [tabStyle]="'border'"
        (tabChange)="onTabChange($event)"
      ></aql-tab-menu>
    </div>

    <div class="flex-1 overflow-y-auto">
      @switch (activeTab()) {
        @case ('html') {
          <app-metadata-html-tab [searchResult]="searchResult()"></app-metadata-html-tab>
        }
        @case ('website') {
          <app-metadata-website-tab
            [searchResult]="searchResult()"
            [isActive]="activeTab() === 'website'"
          ></app-metadata-website-tab>
        }
        @case ('metadata') {
          <app-metadata-info-tab [searchResult]="searchResult()"></app-metadata-info-tab>
        }
        @case ('related') {
          <app-metadata-related-tab
            [relatedSerps]="relatedSerps()"
            [isLoading]="isLoadingDetails()"
            (serpSelected)="onRelatedSerpClick($event)"
          ></app-metadata-related-tab>
        }
        @case ('unfurl') {
          <app-metadata-unfurl-tab
            [unfurlData]="unfurlData()"
            [unfurlWebUrl]="unfurlWebUrl()"
            [originalUrl]="originalCaptureUrl()"
            [isLoading]="isLoadingDetails()"
          ></app-metadata-unfurl-tab>
        }
      }
    </div>
  </div>
</div>
