<aql-panel
  [panelTitle]="panelTitle()"
  [subtitle]="panelSubtitle()"
  [bordered]="true"
  [shadow]="true"
  [isActive]="isActive()"
  class="cursor-pointer hover:shadow-lg transition-shadow duration-200 rounded-2xl block"
  [class.shadow-primary/20]="isActive()"
  (click)="onClick()"
  [hasFooter]="!!result()"
>
  <ng-container header-action>
    @if (result(); as r) {
      <div
        (click)="$event.stopPropagation()"
        (keydown)="$event.stopPropagation()"
        tabindex="0"
        role="button"
      >
        @if (isCompared()) {
          <aql-button
            btnType="primary"
            btnStyle="rounded"
            [outline]="true"
            size="sm"
            iconBefore="bi-check text-lg"
            (buttonClick)="compareService.toggle(r._id)"
          >
            {{ 'compare.addedToCompare' | translate }}
          </aql-button>
        } @else {
          <aql-button
            btnType="default"
            btnStyle="rounded"
            size="sm"
            iconBefore="bi-plus text-lg"
            (buttonClick)="compareService.toggle(r._id)"
          >
            {{ 'compare.addToCompare' | translate }}
          </aql-button>
        }
      </div>
    }
  </ng-container>

  <aql-dropdown
    subtitle-action
    position="right"
    (click)="$event.stopPropagation()"
    [class.hidden]="!result()"
  >
    <aql-button
      trigger
      btnType="icon"
      iconBefore="bi-three-dots-vertical"
      size="xs"
      [aqlTooltip]="'tooltip.search.moreOptions' | translate"
      [tooltipPosition]="'top'"
      [attr.aria-label]="'tooltip.search.moreOptions' | translate"
    ></aql-button>
    <ng-container content>
      @if (result(); as r) {
        <div class="p-3 space-y-2 text-sm min-w-[200px]">
          <div>
            <span class="font-semibold">{{ 'search.scoreLabel' | translate }}</span>
            <span class="ml-2">{{ r._score | number: '1.2-2' }}</span>
          </div>
          <div>
            <span class="font-semibold">{{ 'search.idLabel' | translate }}</span>
            <span class="ml-2 text-xs break-all">{{ r._id }}</span>
          </div>
          <div>
            <span class="font-semibold">{{ 'search.mimeTypeLabel' | translate }}</span>
            <span class="ml-2">{{ r._source.capture.mimetype }}</span>
          </div>
        </div>
      }
    </ng-container>
  </aql-dropdown>

  @if (result(); as r) {
    <app-serp-result-content [result]="r" />
  } @else if (provider(); as p) {
    <app-provider-result-content [provider]="p" />
  } @else if (archive(); as a) {
    <app-archive-result-content [archive]="a" />
  }
  <ng-container footer>
    @if (result(); as r) {
      <div class="flex justify-between">
        <div class="flex items-center gap-2 text-sm text-base-content/60">
          <span>{{ formattedDate() }}</span>
          <span>Â·</span>
          <span>{{ r._source.provider.domain }}</span>
        </div>
        <div class="flex items-center gap-2 text-sm text-base-content/60">
          <span>{{ 'search.scoreLabel' | translate }}</span>
          <span>{{ r._score | number: '1.2-2' }}</span>
        </div>
      </div>
    }
  </ng-container>
</aql-panel>
